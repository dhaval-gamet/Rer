<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìä ‡§°‡•á‡§ü‡§æ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä - Excel Smart Data Entry Tool</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css">
  <link rel="stylesheet" href="css/styles.css">
  <script src="https://unpkg.com/tippy.js@6/dist/tippy-bundle.umd.js"></script>
  <style>
    :root {
      --primary: #1a73e8;
      --primary-dark: #0d47a1;
      --secondary: #4caf50;
      --danger: #f44336;
      --warning: #ff9800;
      --light: #f5f5f5;
      --dark: #333;
      --success: #4caf50;
      --border: #ddd;
      --header-bg: #f8f9fa;
      --cell-hover: #f0f7ff;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #e0f7fa, #f5f5f5);
      color: #333;
      min-height: 100vh;
      padding: 20px;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    header {
      background: var(--primary);
      color: white;
      padding: 25px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .logo i {
      font-size: 2.2rem;
      color: #ffeb3b;
    }
    
    .logo h1 {
      font-size: 1.8rem;
      font-weight: 600;
    }
    
    .stats {
      display: flex;
      gap: 20px;
      background: rgba(255, 255, 255, 0.15);
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 0.95rem;
    }
    
    .stat-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .stat-item i {
      font-size: 1.2rem;
    }
    
    .controls {
      padding: 20px;
      background: var(--light);
      border-bottom: 1px solid var(--border);
    }
    
    .input-group {
      display: flex;
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    #dataInput {
      flex: 1;
      padding: 14px 18px;
      border: 2px solid var(--primary);
      border-radius: 8px 0 0 8px;
      font-size: 1.1rem;
      transition: all 0.3s;
      min-width: 200px;
    }
    
    #dataInput:focus {
      outline: none;
      border-color: var(--primary-dark);
      box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0 24px;
      border-radius: 0 8px 8px 0;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
    }
    
    .btn-speech {
      background: #ff5722;
      color: white;
      border: none;
      padding: 0 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-speech:hover {
      background: #e64a19;
    }
    
    .btn-speech:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .btn-upload {
      background: #673ab7;
      color: white;
      border: none;
      padding: 0 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-upload:hover {
      background: #5e35b1;
    }
    
    .file-input {
      margin-left: 10px;
    }
    
    .chart-controls {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 10px;
    }
    
    .chart-controls input, .chart-controls select {
      padding: 10px;
      border: 2px solid var(--primary);
      border-radius: 8px;
      font-size: 1rem;
    }
    
    select {
      padding: 10px;
      border: 2px solid var(--primary);
      border-radius: 8px;
      font-size: 1rem;
    }
    
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    
    .btn {
      padding: 12px 20px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .btn-success {
      background: var(--success);
      color: white;
    }
    
    .btn-danger {
      background: var(--danger);
      color: white;
    }
    
    .btn-warning {
      background: var(--warning);
      color: white;
    }
    
    .btn-info {
      background: #2196f3;
      color: white;
    }
    
    .content {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .sheet-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .sheet-tabs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .sheet-tab {
      padding: 10px 20px;
      background: var(--light);
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
      border: 2px solid transparent;
    }
    
    .sheet-tab.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary-dark);
    }
    
    .sheet-tab:hover:not(.active) {
      background: #e0e0e0;
    }
    
    .add-sheet {
      background: none;
      border: 2px dashed var(--border);
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .table-container {
      overflow: auto;
      max-height: 500px;
      border: 1px solid var(--border);
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      background: white;
    }
    
    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 800px;
      position: relative;
    }
    
    th, td {
      border: 1px solid var(--border);
      padding: 12px 15px;
      text-align: center;
      min-width: 120px;
    }
    
    thead th {
      background: var(--header-bg);
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    tbody td {
      transition: background 0.2s;
      height: 50px;
      cursor: cell;
    }
    
    tbody td:focus {
      outline: 3px solid var(--primary);
      background: var(--cell-hover);
      z-index: 2;
      position: relative;
    }
    
    tbody tr:hover td {
      background: rgba(240, 247, 255, 0.5);
    }
    
    .row-header {
      background: var(--header-bg);
      font-weight: 600;
      position: sticky;
      left: 0;
      z-index: 5;
      box-shadow: 2px 0 4px rgba(0, 0, 0, 0.05);
    }
    
    .selected {
      background: #e3f2fd !important;
    }
    
    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
      background: var(--light);
      border-top: 1px solid var(--border);
      font-size: 0.9rem;
    }
    
    .cell-status {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .cell-address {
      background: var(--primary);
      color: white;
      padding: 6px 12px;
      border-radius: 4px;
      font-weight: 600;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 8px;
      background: var(--success);
      color: white;
      font-weight: 500;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transform: translateX(120%);
      transition: transform 0.4s ease;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .formula-bar {
      display: flex;
      gap: 10px;
      align-items: center;
      padding: 12px 15px;
      background: var(--light);
      border-radius: 8px;
      margin-top: 10px;
    }
    
    .formula-bar label {
      font-weight: 600;
      color: var(--primary-dark);
    }
    
    .formula-input {
      flex: 1;
      padding: 10px 15px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-family: monospace;
    }
    
    .chart-container {
      margin-top: 20px;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }
    
    #chartCanvas {
      max-width: 100%;
      height: 400px;
    }
    
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        text-align: center;
      }
      
      .logo {
        justify-content: center;
      }
      
      .stats {
        width: 100%;
        justify-content: center;
      }
      
      .button-group {
        justify-content: center;
      }
      
      .sheet-controls {
        flex-direction: column;
      }
      
      .sheet-tabs {
        width: 100%;
        overflow-x: auto;
        padding-bottom: 10px;
      }
      
      .input-group {
        flex-direction: column;
        align-items: stretch;
      }
      
      .btn-primary, .btn-speech, .btn-upload {
        border-radius: 8px;
        margin-left: 0;
        margin-top: 10px;
      }
      
      .table-container {
        max-height: 400px;
      }
    }
    
    @media (max-width: 480px) {
      .btn {
        padding: 10px 15px;
        font-size: 0.85rem;
      }
      
      #dataInput {
        border-radius: 8px;
      }
      
      .chart-container {
        padding: 10px;
        height: 300px;
      }
      
      .controls, .content {
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <i class="fas fa-file-excel"></i>
        <h1>Excel Smart Data Entry Tool</h1>
      </div>
      <nav>
        <a href="index.html" class="btn btn-info" data-tippy-content="‡§π‡•ã‡§Æ ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç">‡§π‡•ã‡§Æ</a>
        <a href="data-entry.html" class="btn btn-info" data-tippy-content="‡§°‡•á‡§ü‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç">‡§°‡•á‡§ü‡§æ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä</a>
        <a href="file-upload.html" class="btn btn-info" data-tippy-content="‡§´‡§º‡§æ‡§á‡§≤ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç">‡§´‡§º‡§æ‡§á‡§≤ ‡§Ö‡§™‡§≤‡•ã‡§°</a>
        <a href="chart-view.html" class="btn btn-info" data-tippy-content="‡§ö‡§æ‡§∞‡•ç‡§ü ‡§¶‡•á‡§ñ‡•á‡§Ç">‡§ö‡§æ‡§∞‡•ç‡§ü</a>
        <a href="formatting.html" class="btn btn-info" data-tippy-content="‡§∏‡•á‡§≤ ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç">‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü‡§ø‡§Ç‡§ó</a>
        <a href="pivot-table.html" class="btn btn-info" data-tippy-content="‡§™‡§ø‡§µ‡§ü ‡§ü‡•á‡§¨‡§≤">‡§™‡§ø‡§µ‡§ü ‡§ü‡•á‡§¨‡§≤</a>
      </nav>
      <div class="stats">
        <div class="stat-item">
          <i class="fas fa-table"></i>
          <span>‡§∂‡•Ä‡§ü: <strong id="sheetCount">1</strong></span>
        </div>
        <div class="stat-item">
          <i class="fas fa-layer-group"></i>
          <span>‡§∏‡•á‡§≤: <strong id="cellCount">50</strong></span>
        </div>
        <div class="stat-item">
          <i class="fas fa-database"></i>
          <span>‡§∏‡•ç‡§ü‡•ã‡§∞‡•á‡§ú: <strong>‡§≤‡•ã‡§ï‡§≤</strong></span>
        </div>
      </div>
    </header>

    <div class="controls">
      <div class="input-group">
        <input type="text" id="dataInput" placeholder="‡§°‡•á‡§ü‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç, ‡§¨‡•ã‡§≤‡•á‡§Ç ‡§Ø‡§æ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç" autofocus aria-label="‡§°‡•á‡§ü‡§æ ‡§á‡§®‡§™‡•Å‡§ü">
        <button class="btn btn-primary" onclick="enterData()" data-tippy-content="‡§ö‡§Ø‡§®‡§ø‡§§ ‡§∏‡•á‡§≤ ‡§Æ‡•á‡§Ç ‡§°‡•á‡§ü‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç">
          <i class="fas fa-arrow-right"></i> ‡§°‡•á‡§ü‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç
        </button>
        <button class="btn btn-speech" id="toggleSpeechBtn" data-tippy-content="‡§µ‡§æ‡§ï‡•ç ‡§™‡§π‡§ö‡§æ‡§® ‡§∂‡•Å‡§∞‡•Ç/‡§∞‡•ã‡§ï‡•á‡§Ç">
          <i class="fas fa-microphone"></i>
          <span id="speechStatus">üéôÔ∏è ‡§¨‡•ã‡§≤‡•á‡§Ç</span>
        </button>
        <select id="speechLang" data-tippy-content="‡§µ‡§æ‡§ï‡•ç ‡§™‡§π‡§ö‡§æ‡§® ‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç">
          <option value="hi-IN">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
          <option value="en-US">English</option>
          <option value="es-ES">Spanish</option>
        </select>
        <select id="dataType" data-tippy-content="‡§°‡•á‡§ü‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç">
          <option value="text">‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü</option>
          <option value="number">‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ</option>
          <option value="date">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï (YYYY-MM-DD)</option>
          <option value="email">‡§à‡§Æ‡•á‡§≤</option>
        </select>
        <select id="navigationDirection" data-tippy-content="‡§°‡•á‡§ü‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§Ö‡§ó‡§≤‡•Ä ‡§∏‡•á‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç">
          <option value="horizontal">‡§ï‡•ç‡§∑‡•à‡§§‡§ø‡§ú (‡§¶‡§æ‡§è‡§Ç)</option>
          <option value="vertical">‡§≤‡§Ç‡§¨‡§µ‡§§ (‡§®‡•Ä‡§ö‡•á)</option>
        </select>
      </div>

      <div class="button-group">
        <button class="btn btn-success" onclick="addRow()" data-tippy-content="‡§®‡§à ‡§™‡§Ç‡§ï‡•ç‡§§‡§ø ‡§ú‡•ã‡§°‡§º‡•á‡§Ç">
          <i class="fas fa-plus"></i> ‡§™‡§Ç‡§ï‡•ç‡§§‡§ø ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
        </button>
        <button class="btn btn-danger" onclick="deleteRow()" data-tippy-content="‡§ö‡§Ø‡§®‡§ø‡§§ ‡§™‡§Ç‡§ï‡•ç‡§§‡§ø ‡§π‡§ü‡§æ‡§è‡§Ç">
          <i class="fas fa-minus"></i> ‡§™‡§Ç‡§ï‡•ç‡§§‡§ø ‡§π‡§ü‡§æ‡§è‡§Ç
        </button>
        <button class="btn btn-success" onclick="addColumn()" data-tippy-content="‡§®‡§Ø‡§æ ‡§ï‡•â‡§≤‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç">
          <i class="fas fa-plus"></i> ‡§ï‡•â‡§≤‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
        </button>
        <button class="btn btn-danger" onclick="deleteColumn()" data-tippy-content="‡§ö‡§Ø‡§®‡§ø‡§§ ‡§ï‡•â‡§≤‡§Æ ‡§π‡§ü‡§æ‡§è‡§Ç">
          <i class="fas fa-minus"></i> ‡§ï‡•â‡§≤‡§Æ ‡§π‡§ü‡§æ‡§è‡§Ç
        </button>
        <button class="btn btn-info" onclick="downloadExcel()" data-tippy-content="Excel ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç">
          <i class="fas fa-download"></i> Excel ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°
        </button>
        <button class="btn btn-info" onclick="exportToPDF()" data-tippy-content="PDF ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç">
          <i class="fas fa-file-pdf"></i> PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°
        </button>
        <button class="btn btn-info" onclick="exportToJSON()" data-tippy-content="JSON ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç">
          <i class="fas fa-file-code"></i> JSON ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°
        </button>
        <button class="btn btn-info" onclick="undo()" data-tippy-content="‡§™‡§ø‡§õ‡§≤‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à ‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§ ‡§ï‡§∞‡•á‡§Ç (Ctrl+Z)">
          <i class="fas fa-undo"></i> ‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§
        </button>
        <button class="btn btn-info" onclick="redo()" data-tippy-content="‡§™‡•Å‡§®‡§É ‡§ï‡§∞‡•á‡§Ç (Ctrl+Y)">
          <i class="fas fa-redo"></i> ‡§™‡•Å‡§®‡§É ‡§ï‡§∞‡•á‡§Ç
        </button>
        <button class="btn btn-warning" onclick="clearData()" data-tippy-content="‡§∏‡§≠‡•Ä ‡§°‡•á‡§ü‡§æ ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç">
          <i class="fas fa-broom"></i> ‡§°‡•á‡§ü‡§æ ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç
        </button>
      </div>
    </div>

    <div class="content">
      <div class="sheet-controls">
        <div class="sheet-tabs">
          <div class="sheet-tab active" data-sheet="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∏‡•Ç‡§ö‡•Ä">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∏‡•Ç‡§ö‡•Ä</div>
          <div class="sheet-tab" data-sheet="‡§Ü‡§¶‡•á‡§∂">‡§Ü‡§¶‡•á‡§∂</div>
          <div class="sheet-tab" data-sheet="‡§á‡§®‡•ç‡§µ‡•á‡§Ç‡§ü‡§∞‡•Ä">‡§á‡§®‡•ç‡§µ‡•á‡§Ç‡§ü‡§∞‡•Ä</div>
          <button class="sheet-tab add-sheet" onclick="addSheet()">
            <i class="fas fa-plus"></i> ‡§®‡§Ø‡§æ ‡§∂‡•Ä‡§ü
          </button>
        </div>

        <div class="formula-bar">
          <label for="formulaInput"><i class="fas fa-square-root-alt"></i> ‡§´‡•â‡§∞‡•ç‡§Æ‡•Ç‡§≤‡§æ:</label>
          <input type="text" id="formulaInput" class="formula-input" placeholder="=SUM(A1:B2)" data-tippy-content="‡§´‡•â‡§∞‡•ç‡§Æ‡•Ç‡§≤‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç (‡§â‡§¶‡§æ., =SUM(A1:B2))" aria-label="‡§´‡•â‡§∞‡•ç‡§Æ‡•Ç‡§≤‡§æ ‡§á‡§®‡§™‡•Å‡§ü">
          <button class="btn btn-success" onclick="applyFormula()" data-tippy-content="‡§´‡•â‡§∞‡•ç‡§Æ‡•Ç‡§≤‡§æ ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§∞‡•á‡§Ç">
            <i class="fas fa-magic"></i> ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§∞‡•á‡§Ç
          </button>
        </div>
      </div>

      <div class="table-container">
        <table id="table" role="grid" aria-label="‡§°‡•á‡§ü‡§æ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ü‡•á‡§¨‡§≤">
          <thead id="tableHead"></thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>

      <div class="status-bar">
        <div class="cell-status">
          <span>‡§ö‡§Ø‡§®‡§ø‡§§ ‡§∏‡•á‡§≤: <span class="cell-address" id="cellAddress">A1</span></span>
          <span>‡§Æ‡§æ‡§®: <span id="cellValue">-</span></span>
          <span>‡§´‡•â‡§∞‡•ç‡§Æ‡•Ç‡§≤‡§æ: <span id="cellFormula">-</span></span>
        </div>
        <div class="last-saved">
          <i class="fas fa-save"></i> ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§∏‡§π‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ: <span id="lastSaved">‡§ï‡§≠‡•Ä ‡§®‡§π‡•Ä‡§Ç</span>
        </div>
      </div>
    </div>

    <div class="notification" id="notification">
      <i class="fas fa-check-circle"></i>
      <span id="notificationText">‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!</span>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.6.4/math.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // App configuration
    const config = {
      totalRows: 10,
      totalCols: 6,
      selectedRow: 0,
      selectedCol: 0,
      formulas: {},
      dataTypes: {},
      lastSaved: null,
      history: [],
      historyIndex: -1,
      currentSheet: '‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∏‡•Ç‡§ö‡•Ä',
      navigationDirection: 'horizontal' // Default to horizontal
    };

    // Sheet management
    const sheets = {
      '‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∏‡•Ç‡§ö‡•Ä': { data: [], formulas: {}, dataTypes: {}, navigationDirection: 'horizontal' },
      '‡§Ü‡§¶‡•á‡§∂': { data: [], formulas: {}, dataTypes: {}, navigationDirection: 'horizontal' },
      '‡§á‡§®‡•ç‡§µ‡•á‡§Ç‡§ü‡§∞‡•Ä': { data: [], formulas: {}, dataTypes: {}, navigationDirection: 'horizontal' }
    };

    // DOM Elements
    const input = document.getElementById("dataInput");
    const formulaInput = document.getElementById("formulaInput");
    const tableHead = document.getElementById("tableHead");
    const tableBody = document.getElementById("tableBody");
    const cellAddress = document.getElementById("cellAddress");
    const cellValue = document.getElementById("cellValue");
    const cellFormula = document.getElementById("cellFormula");
    const lastSaved = document.getElementById("lastSaved");
    const notification = document.getElementById("notification");
    const notificationText = document.getElementById("notificationText");
    const sheetCount = document.getElementById("sheetCount");
    const cellCount = document.getElementById("cellCount");
    const toggleSpeechBtn = document.getElementById("toggleSpeechBtn");
    const speechStatus = document.getElementById("speechStatus");
    const dataType = document.getElementById("dataType");
    const speechLang = document.getElementById("speechLang");
    const navigationDirection = document.getElementById("navigationDirection");

    // Speech Recognition Setup
    let recognition = null;
    let isRecognizing = false;

    if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.lang = speechLang.value;
      recognition.interimResults = true;
      recognition.continuous = true;

      recognition.onresult = function(event) {
        let interimTranscript = '';
        let finalTranscript = '';

        for (let i = event.resultIndex; i < event.results.length; i++) {
          const transcript = event.results[i][0].transcript;
          if (event.results[i].isFinal) {
            finalTranscript += transcript + ' ';
          } else {
            interimTranscript += transcript;
          }
        }

        input.value = finalTranscript + interimTranscript;
      };

      recognition.onerror = function(event) {
        logError('‡§µ‡§æ‡§ï‡•ç ‡§™‡§π‡§ö‡§æ‡§® ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø:', event.error);
        stopSpeechRecognition();
      };

      recognition.onend = function() {
        if (isRecognizing) {
          recognition.start();
        } else {
          stopSpeechRecognition();
        }
      };
    } else {
      toggleSpeechBtn.disabled = true;
      toggleSpeechBtn.style.backgroundColor = '#ccc';
      speechStatus.textContent = '‡§µ‡§æ‡§ï‡•ç ‡§∏‡§Æ‡§∞‡•ç‡§•‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç';
      showNotification('‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§µ‡§æ‡§ï‡•ç ‡§™‡§π‡§ö‡§æ‡§® ‡§ï‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§');
    }

    // Toggle speech recognition
    function toggleSpeechRecognition() {
      if (!recognition) return;

      if (isRecognizing) {
        isRecognizing = false;
        recognition.stop();
      } else {
        isRecognizing = true;
        input.value = '';
        recognition.start();
        speechStatus.textContent = '‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•à...';
        toggleSpeechBtn.style.backgroundColor = '#d81b60';
      }
    }

    // Stop speech recognition
    function stopSpeechRecognition() {
      isRecognizing = false;
      speechStatus.textContent = 'üéôÔ∏è ‡§¨‡•ã‡§≤‡•á‡§Ç';
      toggleSpeechBtn.style.backgroundColor = '#ff5722';
      toggleSpeechBtn.disabled = false;
    }

    // Speech language change
    speechLang.addEventListener('change', (e) => {
      if (recognition) {
        recognition.lang = e.target.value;
        showNotification(`‡§µ‡§æ‡§ï‡•ç ‡§≠‡§æ‡§∑‡§æ ‡§¨‡§¶‡§≤‡§ï‡§∞ ${e.target.options[e.target.selectedIndex].text} ‡§ï‡•Ä ‡§ó‡§à`);
      }
    });

    // Data type validation
    dataType.addEventListener('change', (e) => {
      const cellId = `${String.fromCharCode(65 + config.selectedCol)}${config.selectedRow + 1}`;
      sheets[config.currentSheet].dataTypes[cellId] = e.target.value;
      saveToLocalStorage();
    });

    // Navigation direction change
    navigationDirection.addEventListener('change', (e) => {
      config.navigationDirection = e.target.value;
      sheets[config.currentSheet].navigationDirection = e.target.value;
      saveToLocalStorage();
      showNotification(`‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§∂‡§® ‡§¶‡§ø‡§∂‡§æ: ${e.target.options[e.target.selectedIndex].text}`);
    });

    // Real-time input validation
    input.addEventListener('input', () => {
      const value = input.value.trim();
      const cellId = `${String.fromCharCode(65 + config.selectedCol)}${config.selectedRow + 1}`;
      const type = sheets[config.currentSheet].dataTypes[cellId] || 'text';
      if (!validateData(value, type) && value !== '') {
        input.style.borderColor = 'red';
        showNotification(`‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ${type} ‡§á‡§®‡§™‡•Å‡§ü!`);
      } else {
        input.style.borderColor = 'var(--primary)';
      }
    });

    function validateData(value, type) {
      if (type === 'number' && isNaN(value)) return false;
      if (type === 'date' && !/^\d{4}-\d{2}-\d{2}$/.test(value)) return false;
      if (type === 'email' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) return false;
      return true;
    }

    // Initialize the application
    function initApp() {
      if (!tableHead || !tableBody || !input || !formulaInput) {
        logError('‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï DOM ‡§§‡§§‡•ç‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•á');
        return;
      }

      // Initialize tooltips
      if (typeof tippy !== 'undefined') {
        tippy('[data-tippy-content]');
      } else {
        console.warn('Tippy.js ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§Ü, ‡§ü‡•Ç‡§≤‡§ü‡§ø‡§™‡•ç‡§∏ ‡§Ö‡§ï‡•ç‡§∑‡§Æ‡•§');
      }

      createTable(config.totalRows, config.totalCols);
      loadFromLocalStorage();
      updateCellCount();

      if (config.lastSaved) {
        lastSaved.textContent = new Date(config.lastSaved).toLocaleString();
      }

      input.addEventListener("keydown", handleInputKeydown);
      formulaInput.addEventListener("keydown", handleFormulaKeydown);

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 's') {
          e.preventDefault();
          saveToLocalStorage();
        } else if (e.ctrlKey && e.key === 'z') {
          e.preventDefault();
          undo();
        } else if (e.ctrlKey && e.key === 'y') {
          e.preventDefault();
          redo();
        }
      });

      // Touch support for mobile
      tableBody.addEventListener('touchstart', (e) => {
        const td = e.target.closest('td');
        if (td) {
          const row = td.parentElement.rowIndex - 1;
          const col = td.cellIndex - 1;
          selectCell(row, col);
        }
      });

      // Sheet switching
      document.querySelectorAll('.sheet-tab:not(.add-sheet)').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelector('.sheet-tab.active').classList.remove('active');
          tab.classList.add('active');
          config.currentSheet = tab.dataset.sheet;
          loadSheet(config.currentSheet);
        });
      });

      toggleSpeechBtn.addEventListener('click', toggleSpeechRecognition);

      selectCell(0, 0);

      showNotification('‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!');
    }

    // Create the table structure
    function createTable(rows, cols) {
      const trRow = document.createElement("tr");
      trRow.appendChild(document.createElement("th"));

      for (let i = 0; i < cols; i++) {
        const th = document.createElement("th");
        th.textContent = String.fromCharCode(65 + i);
        trRow.appendChild(th);
      }

      tableHead.innerHTML = "";
      tableHead.appendChild(trRow);

      tableBody.innerHTML = "";

      for (let i = 0; i < rows; i++) {
        const tr = document.createElement("tr");
        const thTr = document.createElement("th");
        thTr.textContent = (i + 1).toString();
        thTr.className = "row-header";
        tr.appendChild(thTr);

        for (let k = 0; k < cols; k++) {
          const td = document.createElement("td");
          td.addEventListener("click", () => selectCell(i, k));
          tr.appendChild(td);
        }

        tableBody.appendChild(tr);
      }
    }

    // Select a cell
    function selectCell(row, col) {
      if (row >= config.totalRows || row < 0 || col >= config.totalCols || col < 0) return;
      config.selectedRow = row;
      config.selectedCol = col;

      clearSelection();

      const td = tableBody.rows[row]?.cells[col + 1];
      if (td) {
        td.classList.add("selected");
        td.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }

      updateStatusBar();

      input.focus();
    }

    // Clear selection from all cells
    function clearSelection() {
      const cells = tableBody.querySelectorAll("td");
      cells.forEach(cell => cell.classList.remove("selected"));
    }

    // Update status bar information
    function updateStatusBar() {
      const colName = String.fromCharCode(65 + config.selectedCol);
      cellAddress.textContent = `${colName}${config.selectedRow + 1}`;

      const cell = tableBody.rows[config.selectedRow]?.cells[config.selectedCol + 1];
      cellValue.textContent = cell?.textContent || "-";

      const cellId = `${colName}${config.selectedRow + 1}`;
      cellFormula.textContent = sheets[config.currentSheet].formulas[cellId] || "-";
    }

    // Handle keydown in main input
    function handleInputKeydown(e) {
      if (e.key === "Enter") {
        enterData();
      } else if (e.key === "ArrowUp" && config.selectedRow > 0) {
        selectCell(config.selectedRow - 1, config.selectedCol);
        e.preventDefault();
      } else if (e.key === "ArrowDown") {
        if (config.selectedRow < config.totalRows - 1) {
          selectCell(config.selectedRow + 1, config.selectedCol);
        } else {
          addRow();
          selectCell(config.selectedRow + 1, config.selectedCol);
        }
        e.preventDefault();
      } else if (e.key === "ArrowLeft" && config.selectedCol > 0) {
        selectCell(config.selectedRow, config.selectedCol - 1);
        e.preventDefault();
      } else if (e.key === "ArrowRight" && config.selectedCol < config.totalCols - 1) {
        selectCell(config.selectedRow, config.selectedCol + 1);
        e.preventDefault();
      }
    }

    // Handle keydown in formula input
    function handleFormulaKeydown(e) {
      if (e.key === "Enter") {
        applyFormula();
      }
    }

    // Evaluate formula
    function evaluateFormula(formula, cellId) {
      try {
        const scope = {};
        for (let i = 0; i < config.totalRows; i++) {
          for (let k = 0; k < config.totalCols; k++) {
            const id = `${String.fromCharCode(65 + k)}${i + 1}`;
            scope[id] = parseFloat(tableBody.rows[i].cells[k + 1]?.textContent) || 0;
          }
        }
        return math.evaluate(formula.slice(1), scope);
      } catch (error) {
        logError('‡§´‡•â‡§∞‡•ç‡§Æ‡•Ç‡§≤‡§æ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§® ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø:', error);
        return '#ERROR';
      }
    }

    // Apply formula
    function applyFormula() {
      const formula = formulaInput.value.trim();
      if (!formula) return;

      const row = config.selectedRow;
      const col = config.selectedCol;
      const cell = tableBody.rows[row]?.cells[col + 1];
      if (!cell) return;

      const cellId = `${String.fromCharCode(65 + col)}${row + 1}`;

      sheets[config.currentSheet].formulas[cellId] = formula;
      const result = evaluateFormula(formula, cellId);
      cell.textContent = result;
      cell.title = `‡§´‡•â‡§∞‡•ç‡§Æ‡•Ç‡§≤‡§æ: ${formula}`;

      formulaInput.value = '';

      showNotification(`‡§´‡•â‡§∞‡•ç‡§Æ‡•Ç‡§≤‡§æ ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ: ${formula} (‡§™‡§∞‡§ø‡§£‡§æ‡§Æ: ${result})`);

      saveToLocalStorage();
    }

    // Enter data from input field
    function enterData() {
      const value = input.value.trim();
      const cellId = `${String.fromCharCode(65 + config.selectedCol)}${config.selectedRow + 1}`;
      const dataType = sheets[config.currentSheet].dataTypes[cellId] || 'text';
      if (!value) return;

      if (!validateData(value, dataType)) {
        showNotification(`‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ${dataType} ‡§á‡§®‡§™‡•Å‡§ü!`);
        return;
      }

      const row = config.selectedRow;
      const col = config.selectedCol;
      const cell = tableBody.rows[row]?.cells[col + 1];
      if (!cell) return;

      cell.textContent = value;

      delete sheets[config.currentSheet].formulas[cellId];

      moveToNextCell();

      saveToLocalStorage();
    }

    // Move to next cell based on navigation direction
    function moveToNextCell() {
      input.value = '';
      if (config.navigationDirection === 'horizontal') {
        if (config.selectedCol < config.totalCols - 1) {
          selectCell(config.selectedRow, config.selectedCol + 1);
        } else if (config.selectedRow < config.totalRows - 1) {
          selectCell(config.selectedRow + 1, 0);
        } else {
          addRow();
          selectCell(config.selectedRow + 1, 0);
        }
      } else {
        if (config.selectedRow < config.totalRows - 1) {
          selectCell(config.selectedRow + 1, config.selectedCol);
        } else {
          addRow();
          selectCell(config.selectedRow + 1, config.selectedCol);
        }
      }
    }

    // Add a new row
    function addRow() {
      config.totalRows++;
      const tr = document.createElement("tr");
      const rowTh = document.createElement("th");
      rowTh.textContent = config.totalRows.toString();
      rowTh.className = "row-header";
      tr.appendChild(rowTh);

      for (let i = 0; i < config.totalCols; i++) {
        const td = document.createElement("td");
        td.addEventListener("click", () => selectCell(config.totalRows - 1, i));
        tr.appendChild(td);
      }

      tableBody.appendChild(tr);
      updateCellCount();
      saveToLocalStorage();
    }

    // Delete current row
    function deleteRow() {
      if (config.totalRows <= 1) {
        showNotification("‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§™‡§Ç‡§ï‡•ç‡§§‡§ø ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è!");
        return;
      }

      tableBody.deleteRow(config.selectedRow);
      config.totalRows--;

      if (config.selectedRow >= config.totalRows) {
        config.selectedRow--;
      }

      const rows = tableBody.querySelectorAll("tr");
      rows.forEach((row, index) => {
        row.cells[0].textContent = (index + 1).toString();
      });

      selectCell(config.selectedRow, config.selectedCol);
      updateCellCount();
      saveToLocalStorage();
    }

    // Add a new column
    function addColumn() {
      if (config.totalCols >= 26) {
        showNotification("‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ 26 ‡§ï‡•â‡§≤‡§Æ!");
        return;
      }

      config.totalCols++;

      const headerRow = tableHead.rows[0];
      const newHeader = document.createElement("th");
      newHeader.textContent = String.fromCharCode(65 + config.totalCols - 1);
      headerRow.appendChild(newHeader);

      const rows = tableBody.querySelectorAll("tr");
      rows.forEach(row => {
        const td = document.createElement("td");
        td.addEventListener("click", () => {
          const rowIndex = Array.from(tableBody.rows).indexOf(row);
          selectCell(rowIndex, config.totalCols - 1);
        });
        row.appendChild(td);
      });

      updateCellCount();
      saveToLocalStorage();
    }

    // Delete current column
    function deleteColumn() {
      if (config.totalCols <= 1) {
        showNotification("‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§ï‡•â‡§≤‡§Æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è!");
        return;
      }

      config.totalCols--;

      const headerRow = tableHead.rows[0];
      headerRow.deleteCell(headerRow.cells.length - 1);

      const rows = tableBody.querySelectorAll("tr");
      rows.forEach(row => {
        row.deleteCell(row.cells.length - 1);
      });

      if (config.selectedCol >= config.totalCols) {
        config.selectedCol--;
      }

      selectCell(config.selectedRow, config.selectedCol);
      updateCellCount();
      saveToLocalStorage();
    }

    // Add new sheet
    function addSheet() {
      const sheetName = `‡§∂‡•Ä‡§ü${Object.keys(sheets).length + 1}`;
      sheets[sheetName] = { data: [], formulas: {}, dataTypes: {}, navigationDirection: 'horizontal' };
      const tab = document.createElement('div');
      tab.className = 'sheet-tab';
      tab.dataset.sheet = sheetName;
      tab.textContent = sheetName;
      tab.addEventListener('click', () => {
        document.querySelector('.sheet-tab.active').classList.remove('active');
        tab.classList.add('active');
        config.currentSheet = sheetName;
        loadSheet(sheetName);
      });
      document.querySelector('.sheet-tabs').insertBefore(tab, document.querySelector('.add-sheet'));
      config.currentSheet = sheetName;
      tab.classList.add('active');
      document.querySelector('.sheet-tab.active')?.classList.remove('active');
      loadSheet(sheetName);
      sheetCount.textContent = Object.keys(sheets).length;
    }

    // Load sheet data
    function loadSheet(sheetName) {
      const sheetData = sheets[sheetName];
      config.formulas = sheetData.formulas || {};
      config.dataTypes = sheetData.dataTypes || {};
      config.totalRows = sheetData.data?.length || 10;
      config.totalCols = sheetData.data?.[0]?.length || 6;
      config.navigationDirection = sheetData.navigationDirection || 'horizontal';

      createTable(config.totalRows, config.totalCols);

      for (let i = 0; i < config.totalRows; i++) {
        for (let j = 0; j < config.totalCols; j++) {
          const cell = tableBody.rows[i].cells[j + 1];
          cell.textContent = sheetData.data?.[i]?.[j] || '';
        }
      }

      navigationDirection.value = config.navigationDirection;
      selectCell(0, 0);
      updateCellCount();
      sheetCount.textContent = Object.keys(sheets).length;
    }

    // Update cell count
    function updateCellCount() {
      if (cellCount) {
        cellCount.textContent = (config.totalRows * config.totalCols).toString();
      }
    }

    // Show notification
    function showNotification(message) {
      if (!notification || !notificationText) return;

      notificationText.textContent = message;
      notification.classList.add('show');

      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Log errors
    function logError(message, error) {
      console.error(`[ExcelTool] ${message}`, error);
      showNotification(`‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ${message}`);
    }

    // Save data to localStorage
    function saveToLocalStorage() {
      const data = {
        totalRows: config.totalRows,
        totalCols: config.totalCols,
        formulas: sheets[config.currentSheet].formulas,
        dataTypes: sheets[config.currentSheet].dataTypes,
        cellData: [],
        navigationDirection: config.navigationDirection
      };

      for (let i = 0; i < config.totalRows; i++) {
        const rowData = [];
        for (let j = 0; j < config.totalCols; j++) {
          const cell = tableBody.rows[i].cells[j + 1]?.textContent || '';
          rowData.push(cell);
        }
        data.cellData.push(rowData);
      }

      sheets[config.currentSheet].data = data.cellData;
      sheets[config.currentSheet].formulas = data.formulas;
      sheets[config.currentSheet].dataTypes = data.dataTypes;
      sheets[config.currentSheet].navigationDirection = data.navigationDirection;

      config.history = config.history.slice(0, config.historyIndex + 1);
      config.history.push(data);
      config.historyIndex = config.history.length - 1;
      if (config.history.length > 10) {
        config.history.shift();
        config.historyIndex--;
      }

      localStorage.setItem("excelData", JSON.stringify(sheets));

      config.lastSaved = Date.now();
      if (lastSaved) {
        lastSaved.textContent = new Date(config.lastSaved).toLocaleString();
      }

      showNotification("‡§°‡•á‡§ü‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡§π‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ!");
    }

    // Load data from localStorage
    function loadFromLocalStorage() {
      const savedData = localStorage.getItem("excelData");
      if (!savedData) return;

      const data = JSON.parse(savedData);
      Object.assign(sheets, data);

      loadSheet(config.currentSheet);

      // Load navigation direction
      if (data[config.currentSheet]?.navigationDirection) {
        config.navigationDirection = data[config.currentSheet].navigationDirection;
        navigationDirection.value = config.navigationDirection;
      }

      config.lastSaved = Date.now();
      if (lastSaved) {
        lastSaved.textContent = new Date().toLocaleString();
      }

      showNotification("‡§°‡•á‡§ü‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§≤‡•ã‡§° ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!");
    }

    // Undo last action
    function undo() {
      if (config.historyIndex > 0) {
        config.historyIndex--;
        const data = config.history[config.historyIndex];
        loadData(data);
        showNotification("‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§ ‡§∏‡§´‡§≤!");
      }
    }

    // Redo last action
    function redo() {
      if (config.historyIndex < config.history.length - 1) {
        config.historyIndex++;
        const data = config.history[config.historyIndex];
        loadData(data);
        showNotification("‡§™‡•Å‡§®‡§É ‡§ï‡§∞‡•á‡§Ç ‡§∏‡§´‡§≤!");
      }
    }

    // Load data into table
    function loadData(data) {
      config.totalRows = data.totalRows;
      config.totalCols = data.totalCols;
      sheets[config.currentSheet].formulas = data.formulas || {};
      sheets[config.currentSheet].dataTypes = data.dataTypes || {};
      sheets[config.currentSheet].navigationDirection = data.navigationDirection || 'horizontal';

      createTable(config.totalRows, config.totalCols);

      for (let i = 0; i < config.totalRows; i++) {
        for (let k = 0; k < config.totalCols; k++) {
          tableBody.rows[i].cells[k + 1].textContent = data.cellData[i][k] || '';
        }
      }

      navigationDirection.value = config.navigationDirection;
      selectCell(Math.min(config.selectedRow, config.totalRows - 1), Math.min(config.selectedCol, config.totalCols - 1));
    }

    // Clear all data
    function clearData() {
      if (!confirm("‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§Æ‡•á‡§Ç ‡§∏‡§≠‡•Ä ‡§°‡•á‡§ü‡§æ ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç? ‡§Ø‡§π ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à ‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä‡•§")) {
        return;
      }

      localStorage.removeItem("excelData");
      sheets[config.currentSheet].formulas = {};
      sheets[config.currentSheet].dataTypes = {};
      sheets[config.currentSheet].navigationDirection = 'horizontal';
      config.history = [];
      config.historyIndex = -1;

      const cells = tableBody.querySelectorAll("td");
      cells.forEach(cell => {
        cell.textContent = '';
      });

      navigationDirection.value = config.navigationDirection;
      saveToLocalStorage();
      showNotification("‡§°‡•á‡§ü‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡§æ‡§´‡§º ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!");
    }

    // Download Excel file
    function downloadExcel() {
      const data = [];
      const headers = [];
      for (let j = 0; j < config.totalCols; j++) {
        headers.push(String.fromCharCode(65 + j));
      }
      data.push(headers);

      for (let i = 0; i < tableBody.rows.length; i++) {
        const row = [];
        for (let j = 1; j <= config.totalCols; j++) {
          row.push(tableBody.rows[i].cells[j].textContent);
        }
        data.push(row);
      }

      const ws = XLSX.utils.aoa_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Sheet1");

      const today = new Date();
      const dateString = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
      const fileName = `data-${dateString}.xlsx`;

      XLSX.writeFile(wb, fileName);

      showNotification(`Excel ‡§´‡§º‡§æ‡§á‡§≤ ${fileName} ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡•Ä ‡§ó‡§à!`);
    }

    // Export to PDF
    function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(16);
      doc.text("Excel Smart Data Sheet", 10, 10);
      doc.setFontSize(12);

      let y = 20;
      for (let i = 0; i < config.totalRows; i++) {
        const row = [];
        for (let j = 0; j < config.totalCols; j++) {
          row.push(tableBody.rows[i].cells[j + 1].textContent || '');
        }
        doc.text(row.join(' | '), 10, y);
        y += 10;
      }

      const today = new Date();
      const dateString = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
      doc.save(`data-${dateString}.pdf`);

      showNotification('PDF ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!');
    }

    // Export to JSON
    function exportToJSON() {
      const data = {
        totalRows: config.totalRows,
        totalCols: config.totalCols,
        formulas: sheets[config.currentSheet].formulas,
        dataTypes: sheets[config.currentSheet].dataTypes,
        cellData: [],
        navigationDirection: config.navigationDirection
      };

      for (let i = 0; i < config.totalRows; i++) {
        const rowData = [];
        for (let j = 0; j < config.totalCols; j++) {
          rowData.push(tableBody.rows[i].cells[j + 1].textContent);
        }
        data.cellData.push(rowData);
      }

      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);

      const today = new Date();
      const dateString = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
      const fileName = `data-${dateString}.json`;

      const a = document.createElement('a');
      a.href = url;
      a.download = fileName;
      a.click();
      URL.revokeObjectURL(url);

      showNotification(`JSON ‡§´‡§º‡§æ‡§á‡§≤ ${fileName} ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡•Ä ‡§ó‡§à!`);
    }

    // Initialize the app when DOM is ready
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
